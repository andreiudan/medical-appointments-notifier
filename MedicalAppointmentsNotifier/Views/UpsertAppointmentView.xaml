<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="MedicalAppointmentsNotifier.Views.UpsertAppointmentView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MedicalAppointmentsNotifier.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Adauga Scrisoare Medicala">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid x:Name="RootGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <TextBlock Text="{x:Bind ViewModel.Title}" 
                   FontSize="28" 
                   Style="{StaticResource TitleTextBlockStyle}"
                   Grid.Row="0"
                   HorizontalAlignment="Center"
                   Padding="24, 32, 24, 24"/>
        
        <!-- Medical Specialty -->
        <ComboBox Grid.Row="1"
                  Margin="16, 0, 16, 24"
                  Header="Specializarea Medicala"
                  ItemsSource="{x:Bind ViewModel.MedicalSpecialties}"
                  SelectedItem="{x:Bind ViewModel.Specialty, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                  Grid.Column="0"
                  HorizontalAlignment="Stretch">
        </ComboBox>
        
        <!-- Months Interval -->
        <StackPanel Spacing="12"
                    Grid.Row="2"
                    Margin="16, 0, 16, 24">
            <NumberBox Header="Interval Scrisoare Medicala (luni)"
                       Text="{x:Bind ViewModel.MonthsInterval, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                       SpinButtonPlacementMode="Inline"
                       HorizontalAlignment="Stretch"
                       Minimum="0"/>
            
            <TextBlock Foreground="{ThemeResource SystemErrorTextColor}"
                       Text="{x:Bind ViewModel.MonthsIntervalErrorMessage, Mode=OneWay}"
                       Visibility="{Binding MonthsIntervalErrorMessage, Converter={StaticResource StringToVisibilityConverter}}"/>
        </StackPanel>

        <!-- Dates -->
        <StackPanel Grid.Row="3"
                    Margin="16, 0, 16, 24">
            <Grid ColumnSpacing="24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="50*"/>
                    <ColumnDefinition Width="50*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" 
                           Grid.Column="0"
                           Text="Perioada valabilitate"
                           Style="{StaticResource BaseTextBlockStyle}"/>

                <CalendarDatePicker PlaceholderText="Alege o data" 
                                    Header="Din data" 
                                    Grid.Column="0"
                                    Grid.Row="1"
                                    Date="{x:Bind ViewModel.IssuedOn, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    DateFormat="{}{day.integer}/{month.integer}/{year.full}"
                                    HorizontalAlignment="Stretch"/>
                
                <CalendarDatePicker PlaceholderText="Alege o data" 
                                    Header="Pana in data" 
                                    Grid.Column="1" 
                                    Grid.Row="1"
                                    HorizontalAlignment="Stretch"
                                    Date="{x:Bind ViewModel.ExpiringDate, Mode=OneWay}"
                                    DateFormat="{}{day.integer}/{month.integer}/{year.full}"
                                    IsEnabled="False"
                                    ToolTipService.ToolTip="Pentru a modifica data de expirare trebuie modificata data de inceput sau intervalul scrisorii medicale."/>
            </Grid>
            
            <TextBlock Foreground="{ThemeResource SystemErrorTextColor}"
                       Text="{x:Bind ViewModel.DateIntervalErrorMessage, Mode=OneWay}"
                       Visibility="{Binding DateIntervalErrorMessage, Converter={StaticResource StringToVisibilityConverter}}"/>
        </StackPanel>

        <!-- Has Schedule -->
        <CheckBox Grid.Row="4"
                  Margin="16, 0, 16, 24"
                  IsChecked="{x:Bind ViewModel.IsScheduled, Mode=TwoWay}"
                  Checked="ResizeWindowOnChecked"
                  Unchecked="ResizeWindowOnUnchecked">
            Are programare
        </CheckBox>

        <!-- Schedule Info -->
        <StackPanel Grid.Row="5"
                    Margin="16, 0, 16, 24"
                    Spacing="16"
                    DataContext="{x:Bind ViewModel}"
                    Visibility="{Binding IsScheduled, Converter={StaticResource TrueToVisibilityConverter}, Mode=OneWay}">
            <TextBlock Grid.Row="0" 
                       Grid.Column="0"
                       Text="Informatii Progamare"
                       Style="{StaticResource BaseTextBlockStyle}"/>

            <TextBox Header="Locatia"
                     Text="{x:Bind ViewModel.ScheduledLocation, Mode=TwoWay}"/>
            
            <Grid ColumnSpacing="24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="50*"/>
                    <ColumnDefinition Width="50*"/>
                </Grid.ColumnDefinitions>
                
                <CalendarDatePicker Grid.Column="0"
                                    PlaceholderText="Alege o data" 
                                    Header="Data" 
                                    HorizontalAlignment="Stretch"
                                    Date="{x:Bind ViewModel.ScheduledDate, Mode=TwoWay}"
                                    DateFormat="{}{day.integer}/{month.integer}/{year.full}"/>

                <TimePicker Header="Ora"
                            Grid.Column="1"
                            Time="{x:Bind ViewModel.ScheduledTime, Mode=TwoWay}"/>
            </Grid>
        </StackPanel>

        <!-- Actions -->
        <Grid Grid.Row="6" 
              ColumnSpacing="8" 
              Padding="24"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Bottom"
              Background="{ThemeResource LayerFillColorDefaultBrush}" 
              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
              BorderThickness="0,1,0,0">
            
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="50*"/>
                <ColumnDefinition Width="50*"/>
            </Grid.ColumnDefinitions>

            <Button x:Name="btnClose" 
                    Content="Anuleaza" 
                    Grid.Column="0"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Center"
                    Click="btnClose_Click"/>
            
            <Button Style="{StaticResource AccentButtonStyle}"
                    Content="{x:Bind ViewModel.UpsertButtonText}" 
                    Grid.Column="1" 
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Center"
                    Command="{x:Bind ViewModel.UpsertAppointmentCommand}"/>
        </Grid>
    </Grid>
</Window>
